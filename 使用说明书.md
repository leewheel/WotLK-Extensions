# WotLK-Extensions 使用说明书

## 目录
1. [系统要求](#系统要求)
2. [安装指南](#安装指南)
3. [配置说明](#配置说明)
4. [功能使用](#功能使用)
5. [故障排除](#故障排除)
6. [常见问题](#常见问题)

## 系统要求

### 硬件要求
- **操作系统**: Windows 7/8/10/11 (32位或64位)
- **内存**: 至少2GB RAM
- **存储**: 100MB可用空间

### 软件要求
- **Visual Studio 2019/2022** (用于编译)
- **CMake 3.25+** (构建系统)
- **魔兽世界巫妖王之怒客户端** (3.3.5版本)

## 安装指南

### 第一步：获取源码
```bash
git clone https://github.com/Alyst3r/WotLK-Extensions.git
cd WotLK-Extensions
```

### 第二步：生成Visual Studio项目
1. 打开CMake GUI
2. 设置源码目录和构建目录
3. 点击"Configure"按钮
4. **重要**: 在配置过程中，将"Optional platform for generator"设置为"Win32"
5. 重复点击"Configure"直到红色选项消失
6. 点击"Generate"生成项目文件

### 第三步：编译项目
1. 打开生成的Visual Studio解决方案
2. 进入"Build" → "Configuration Manager"
3. 将"Active solution configuration"设置为"Release"
4. 在解决方案资源管理器中选择"ALL_BUILD"
5. 按Ctrl+B开始编译

### 第四步：获取编译产物
编译完成后，在以下目录找到生成的文件：
- `[构建目录]/Patcher/Release/Patcher.exe`
- `[构建目录]/WotLKExtensions/Release/WotLKExtensions.dll`

### 第五步：安装到游戏目录
1. 将`Patcher.exe`复制到任意位置
2. 将`WotLKExtensions.dll`复制到你的Wow.exe所在目录

### 第六步：修补游戏客户端
1. **方法一**: 将Wow.exe拖拽到Patcher.exe上
2. **方法二**: 使用命令行 `Patcher.exe "路径\到\你的\Wow.exe"`

## 配置说明

### 启用/禁用功能

#### 通过CMake配置 (推荐)
在CMake GUI中，可以配置以下选项：

| 选项名称 | 默认值 | 说明 |
|---------|-------|------|
| CUSTOM_DBC | OFF | 启用自定义DBC加载器 |
| LFGROLES_DBC | OFF | 地下城查找器角色DBC |
| ZONELIGHT_DBC | OFF | 区域光照DBC |
| NOAMMO_PATCH | OFF | 移除弹药需求 |
| CHARCREATIONRACE_FIX | ON | 修复21+种族创建崩溃 |
| COMBOPOINT_FIX | ON | 连击点修复 |
| CLASSLFDROLES_PATCH | ON | 12+职业地下城查找器 |
| OOBLUAFUNCTIONS_PATCH | ON | 外部Lua函数支持 |
| CUSTOMPACKETS_PATCH | OFF | 自定义数据包 |
| ITEMMODEXT_PATCH | OFF | 物品修饰符扩展 |
| ACTIONBAR_LUA | OFF | 动作栏Lua函数 |
| DEVHELPER_LUA | OFF | 开发辅助Lua函数 |

#### 通过代码配置
1. 在Visual Studio中打开项目
2. 导航到`WotLKExtensions` → `Header files`
3. 找到并编辑`PatchConfig.h`文件
4. 将需要的功能设置为`true`
5. 重新编译项目

## 功能使用

### 1. 客户端补丁功能

#### 无弹药模式
- **功能**: 远程武器无需弹药即可使用
- **配置**: 启用`NOAMMO_PATCH`
- **注意**: 可能需要服务器端配合修改弹药显示逻辑

#### 多种族支持
- **功能**: 支持最多31个可选种族
- **配置**: 启用`CHARCREATIONRACE_FIX`
- **效果**: 解决角色创建界面超过21个种族时的崩溃问题

#### 连击点扩展
- **功能**: 所有职业都可以使用连击点系统
- **配置**: 启用`COMBOPOINT_FIX`
- **用途**: 为自定义职业系统提供支持

### 2. Lua函数使用

#### 动作栏操作
```lua
-- 替换动作栏中的法术
ReplaceActionBarSpell(旧法术ID, 新法术ID)

-- 在指定动作栏位置设置法术
SetSpellInActionBarSlot(法术ID, 位置编号)

-- 查找法术在动作栏中的所有位置
local slots = {FindSpellActionBarSlots(法术ID)}
```

#### 法术信息查询
```lua
-- 获取法术描述
local desc = GetSpellDescription(法术ID)

-- 获取法术名称和等级
local name, rank = GetSpellNameById(法术ID)

-- 获取当前变形形态
local formId = GetShapeshiftFormId()
```

#### 开发调试功能
```lua
-- 重新加载当前地图
ReloadMap()

-- 闪烁游戏窗口
FlashGameWindow()

-- 切换各种渲染模式
ToggleWireframeMode()
ToggleTerrain()
ToggleLiquids()
ToggleM2()
ToggleWMO()
```

### 3. 自定义DBC使用

#### 准备DBC文件
1. 创建自定义DBC文件，使用`.cdbc`扩展名
2. 将文件放入MPQ存档的`DBFilesClient/`目录
3. 确保文件格式符合规范

#### LFGRoles.cdbc格式
```
列1: ClassID (职业ID)
列2: RoleMask (角色掩码)
```

#### ZoneLight.cdbc格式
```
列1: ID
列2: Name (注释用)
列3: MapID (地图ID)
列4: LightID (光照ID)
```

### 4. 自定义数据包使用

#### 战斗评级扩展
```lua
-- 获取自定义战斗评级的原始值
local value = GetCustomCombatRating(评级ID)

-- 获取自定义战斗评级的百分比加成
local bonus = GetCustomCombatRatingBonus(评级ID)
```

#### 墓地传送
```lua
-- 传送到最近的墓地
PortGraveyard()
```

## 故障排除

### 常见编译错误

#### CMake配置失败
**问题**: "Optional platform for generator"未设置
**解决**: 在CMake GUI中明确选择"Win32"平台

#### 链接错误
**问题**: 找不到头文件或库文件
**解决**: 
1. 确保所有依赖项已正确安装
2. 检查Visual Studio版本兼容性
3. 清理并重新生成项目

#### 运行时错误
**问题**: DLL加载失败
**解决**:
1. 确保Wow.exe未被其他程序占用
2. 以管理员身份运行Patcher
3. 检查杀毒软件是否拦截

### 游戏内问题

#### 功能不生效
**检查步骤**:
1. 确认相应补丁已启用
2. 验证DLL文件在正确位置
3. 检查游戏客户端版本是否为3.3.5
4. 查看游戏日志是否有错误信息

#### 游戏崩溃
**排查方法**:
1. 禁用所有可选补丁，逐个启用测试
2. 检查自定义DBC文件格式是否正确
3. 确认服务器端是否支持相应功能
4. 检查内存使用情况

## 常见问题

### Q: 是否支持64位客户端？
A: 目前仅支持32位客户端，64位支持正在开发中。

### Q: 可以在官方服务器使用吗？
A: **绝对不可以**！使用此工具可能导致账户被封禁，仅适用于私人服务器。

### Q: 如何卸载补丁？
A: 使用原始未修改的Wow.exe替换当前文件即可。

### Q: 支持哪些操作系统？
A: 支持Windows 7及以上版本，包括64位系统上的32位兼容模式。

### Q: 如何获取技术支持？
A: 可以通过GitHub Issues或WoW Modding Community Discord寻求帮助。

### Q: 可以自定义新的补丁功能吗？
A: 可以，项目开源，欢迎提交Pull Request贡献代码。

### Q: 性能影响如何？
A: 大部分功能对性能影响很小，但某些调试功能可能影响帧率。

### Q: 如何备份原始文件？
A: 在使用Patcher之前，建议备份原始的Wow.exe文件。

## 安全提醒

1. **仅用于私人服务器**: 不要在官方或商业服务器使用
2. **账户安全**: 使用前了解相关风险
3. **定期备份**: 备份重要游戏文件
4. **杀毒软件**: 可能需要添加例外规则
5. **网络环境**: 确保服务器端支持相应功能

## 版本历史

当前版本基于TSWoW的ClientExtensions开发，整合了多个社区贡献者的改进和修复。

## 联系方式

- **GitHub**: https://github.com/Alyst3r/WotLK-Extensions
- **社区**: WoW Modding Community Discord
- **问题反馈**: GitHub Issues

---

*本说明书最后更新时间: 2026年2月*
